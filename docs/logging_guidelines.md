# üìä –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è FastAPI Foundry

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 9 –¥–µ–∫–∞–±—Ä—è 2025  

---

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê

1. **–í–°–ï –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è**
2. **–û—à–∏–±–∫–∏ –í–°–ï–ì–î–ê —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º**
3. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç–∞–π–º–∏–Ω–≥–æ–º**
4. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞**

---

## üìã –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

| –£—Ä–æ–≤–µ–Ω—å | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –ü—Ä–∏–º–µ—Ä |
|---------|-------------------|--------|
| `DEBUG` | –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π, –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è |
| `INFO` | –ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤, —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `WARNING` | –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã | Fallback –Ω–∞ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å, —Ç–∞–π–º–∞—É—Ç—ã |
| `ERROR` | –û—à–∏–±–∫–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è | –û—à–∏–±–∫–∏ API, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ |
| `CRITICAL` | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ | –ü–∞–¥–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞, –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö |

---

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from src.utils.logging_system import get_logger

# –°–æ–∑–¥–∞—Ç—å –ª–æ–≥–≥–µ—Ä –¥–ª—è –º–æ–¥—É–ª—è
logger = get_logger("model-manager")

# –ü—Ä–æ—Å—Ç–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logger.info("–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
logger.error("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Foundry", model_id="deepseek-chat")
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
logger.info("API –∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–æ—Ç–∞–Ω", 
           method="POST", 
           endpoint="/api/v1/generate",
           duration=1.234,
           tokens=150)

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –º–æ–¥–µ–ª—è–º–∏
logger.log_model_operation(
    model_id="deepseek-chat",
    operation="generate_text", 
    status="success",
    duration=2.1,
    tokens_generated=75
)
```

### –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
with logger.timer("model_loading", model_id="qwen-chat"):
    model = await load_model("qwen-chat")
    
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "–û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: model_loading (3.456s)"
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
try:
    result = await risky_operation()
    logger.info("–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ", result_size=len(result))
except Exception as e:
    logger.exception("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏", 
                    operation="risky_operation",
                    input_params={"param1": "value1"})
    raise
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤

```
logs/
‚îú‚îÄ‚îÄ fastapi-foundry.log          # –û—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏
‚îú‚îÄ‚îÄ fastapi-foundry-errors.log   # –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
‚îú‚îÄ‚îÄ fastapi-foundry-structured.jsonl  # JSON –ª–æ–≥–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
‚îú‚îÄ‚îÄ model-manager.log            # –õ–æ–≥–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ api-requests.log             # HTTP –∑–∞–ø—Ä–æ—Å—ã
‚îî‚îÄ‚îÄ mcp-client.log              # MCP –æ–ø–µ—Ä–∞—Ü–∏–∏
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –†–µ–∂–∏–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (dev/prod)
FASTAPI_FOUNDRY_MODE=dev

# –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
LOG_LEVEL=INFO

# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ª–æ–≥–æ–≤
LOG_DIR=logs
```

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

#### Development Mode (`dev`)
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—å
- DEBUG —É—Ä–æ–≤–µ–Ω—å –≤–∫–ª—é—á–µ–Ω
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫
- –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥

#### Production Mode (`prod`)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—å
- INFO+ —É—Ä–æ–≤–µ–Ω—å
- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- –¢–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—å

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏–∑

### –ê–Ω–∞–ª–∏–∑ JSON –ª–æ–≥–æ–≤

```bash
# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
jq 'select(.level == "error" and (.timestamp | fromdateiso8601) > (now - 3600))' logs/fastapi-foundry-structured.jsonl

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ API endpoints
jq -r 'select(.api_path) | .api_path' logs/fastapi-foundry-structured.jsonl | sort | uniq -c

# –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
jq -r 'select(.duration) | .duration' logs/fastapi-foundry-structured.jsonl | awk '{sum+=$1; count++} END {print sum/count}'
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```python
# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
logger.info("–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ",
           memory_usage_mb=get_memory_usage(),
           active_models=len(model_manager.models),
           uptime_seconds=get_uptime())
```

---

## üö® –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ó–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
logger.info("–ó–∞–ø—É—Å–∫ FastAPI Foundry", version="1.0.0", port=8000)
try:
    await start_server()
    logger.info("–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ")
except Exception as e:
    logger.critical("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞", error=str(e))
    raise

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
print("–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞...")
if not await start_server():
    return  # –ë–ï–ó –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø!
```

### 2. API –∑–∞–ø—Ä–æ—Å—ã

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
@app.middleware("http")
async def log_requests(request: Request, call_next):
    start_time = time.time()
    
    logger.debug("–í—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å", 
                method=request.method, 
                path=request.url.path)
    
    response = await call_next(request)
    duration = time.time() - start_time
    
    logger.log_api_request(
        method=request.method,
        path=request.url.path,
        status_code=response.status_code,
        duration=duration
    )
    
    return response
```

### 3. –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–æ–¥–µ–ª—è–º–∏

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
async def load_model(model_id: str):
    logger.info("–ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏", model_id=model_id)
    
    try:
        with logger.timer("model_loading", model_id=model_id):
            model = await foundry_client.load_model(model_id)
            
        logger.info("–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ", 
                   model_id=model_id,
                   model_size=model.size)
        return model
        
    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏", 
                    model_id=model_id, 
                    error=str(e))
        raise
```

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
try:
    result = await process_request(data)
except ValidationError as e:
    logger.warning("–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö", 
                  validation_errors=e.errors(),
                  input_data=data)
    raise HTTPException(400, "Invalid input")
except Exception as e:
    logger.exception("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞",
                    request_id=request_id,
                    user_id=user_id)
    raise HTTPException(500, "Internal server error")
```

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ KPI

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏

- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API** - –≤—Å–µ endpoints
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π** - —á–∞—Å—Ç–æ—Ç–∞ –≤—ã–∑–æ–≤–æ–≤
- **–û—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø–∞–º** - 4xx, 5xx, exceptions
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ø–∞–º—è—Ç—å, CPU, –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

```python
# –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
logger.info("–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞",
           model_id=model_id,
           input_tokens=len(prompt.split()),
           output_tokens=len(response.split()),
           generation_time=duration,
           user_id=user_id)
```

---

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –í–∫–ª—é—á–µ–Ω–∏–µ debug —Ä–µ–∂–∏–º–∞

```python
# –í—Ä–µ–º–µ–Ω–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ debug –¥–ª—è –º–æ–¥—É–ª—è
debug_logger = get_logger("model-manager", mode="dev")
debug_logger.debug("–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏")
```

### –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```python
def trace_execution(func):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π"""
    def wrapper(*args, **kwargs):
        logger.debug(f"–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ {func.__name__}", 
                    args=args, kwargs=kwargs)
        try:
            result = func(*args, **kwargs)
            logger.debug(f"–§—É–Ω–∫—Ü–∏—è {func.__name__} –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
            return result
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ {func.__name__}: {e}")
            raise
    return wrapper
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

- [ ] –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- [ ] –û—à–∏–±–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
- [ ] –ù–µ—Ç `print()` –≤–º–µ—Å—Ç–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ JSON –ª–æ–≥–∞—Ö
- [ ] –¢–∞–π–º–µ—Ä—ã –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:

- ‚ùå `print()` –≤–º–µ—Å—Ç–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚ùå –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚ùå –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –∏ —Ç–æ–∫–µ–Ω–æ–≤
- ‚ùå –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ü–∏–∫–ª–∞—Ö
- ‚ùå –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

**–ü–æ–º–Ω–∏:** –•–æ—Ä–æ—à–∏–µ –ª–æ–≥–∏ = –±—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º!